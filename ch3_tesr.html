<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº’å‹•å¼å‚³è¼¸å±¤å­¸ç¿’æ‡‰ç”¨ç¨‹å¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Base font for the entire body */
        body { font-family: 'Inter', sans-serif; }
        /* Hide content sections by default */
        .content-section { display: none; }
        /* Show active content section */
        .content-section.active { display: block; }
        /* Navigation button transitions */
        .nav-button { transition: all 0.3s ease; }
        /* Active navigation button styling */
        .nav-button.active { background-color: #fbbf24; color: #78350f; }
        /* Navigation button hover effect */
        .nav-button:hover { background-color: #f59e0b; }
        /* Styling for diagram boxes */
        .diagram-box { border: 1px solid #e5e7eb; padding: 10px; margin-top: 10px; border-radius: 8px; background-color: #f9fafb; }
        /* Interactive TCP/UDP segment field styling */
        .tcp-segment-field { cursor: pointer; transition: background-color 0.3s; padding: 4px; border-radius: 4px; }
        /* TCP/UDP segment field hover effect */
        .tcp-segment-field:hover { background-color: #e0f2fe; }
        /* FSM state styling for RDT principles */
        .fsm-state { border: 2px solid #9ca3af; padding: 10px; margin: 5px; border-radius: 8px; text-align: center; }
        /* FSM arrow styling */
        .fsm-arrow { text-align: center; font-size: 24px; margin: 0 5px; }
        /* Handshake step styling (initially faded) */
        .handshake-step { opacity: 0.3; transition: opacity 0.5s ease-in-out; margin-bottom:10px; padding:10px; border:1px solid #ccc; border-radius:5px; }
        /* Visible handshake step styling */
        .handshake-step.visible { opacity: 1; }
        /* Chart container for responsiveness */
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 300px; max-height: 400px; }
        /* Adjust chart container height for medium screens */
        @media (min-width: 768px) { .chart-container { height: 350px; } }
        /* Tooltip styling for interactive fields */
        .tooltip { position: absolute; background-color: #333; color: white; padding: 5px 10px; border-radius: 4px; font-size: 0.875rem; z-index: 10; display: none; white-space: pre-wrap; }

        /* Chatbot specific styles */
        /* Floating chat button */
        .chat-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #f59e0b; /* amber-500 */
            color: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: background-color 0.3s ease;
        }
        /* Chat button hover effect */
        .chat-button:hover { background-color: #d97706; /* amber-600 */ }

        /* Chat window styling (initially hidden) */
        .chat-window {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 350px;
            height: 450px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            z-index: 999;
            overflow: hidden;
            transform: translateY(100%); /* Start off-screen */
            opacity: 0; /* Start invisible */
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
        /* Chat window open state */
        .chat-window.open {
            transform: translateY(0); /* Slide into view */
            opacity: 1; /* Become visible */
        }
        /* Chat header styling */
        .chat-header {
            background-color: #f59e0b; /* amber-500 */
            color: white;
            padding: 12px 16px;
            font-weight: bold;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        /* Chat close button styling */
        .chat-close-button {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        /* Chat messages display area */
        .chat-messages {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: #f9fafb; /* gray-50 */
            border-bottom: 1px solid #e5e7eb; /* gray-200 */
        }
        /* Chat input area layout */
        .chat-input-area {
            display: flex;
            padding: 15px;
            border-top: 1px solid #e5e7eb; /* gray-200 */
        }
        /* Chat input textarea styling */
        .chat-input {
            flex-grow: 1;
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 14px;
            resize: none; /* Disable manual resize */
            min-height: 40px;
            max-height: 80px; /* Limit input height */
            overflow-y: auto;
        }
        /* Chat send button styling */
        .chat-send-button {
            background-color: #f59e0b; /* amber-500 */
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            margin-left: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        /* Chat send button hover effect (when not disabled) */
        .chat-send-button:hover:not(:disabled) { background-color: #d97706; /* amber-600 */ }
        /* Chat send button disabled state */
        .chat-send-button:disabled { background-color: #ccc; cursor: not-allowed; }

        /* Message bubble common styling */
        .message-bubble {
            padding: 8px 12px;
            border-radius: 12px;
            margin-bottom: 8px;
            max-width: 80%;
            word-wrap: break-word;
        }
        /* User message bubble styling */
        .message-user {
            background-color: #bfdbfe; /* blue-200 */
            align-self: flex-end;
            margin-left: auto;
        }
        /* Bot message bubble styling */
        .message-bot {
            background-color: #e0f2fe; /* light blue-100 */
            align-self: flex-start;
            margin-right: auto;
        }
        /* Loading message bubble styling */
        .message-loading {
            background-color: #e5e7eb; /* gray-200 */
            color: #6b7280; /* gray-500 */
            font-style: italic;
        }
    </style>
</head>
<body class="bg-amber-50 text-amber-900">
    <div class="container mx-auto p-4">
        <header class="bg-amber-500 text-white p-6 rounded-lg shadow-lg mb-6">
            <h1 class="text-3xl font-bold text-center">å‚³è¼¸å±¤äº’å‹•å­¸ç¿’æŒ‡å—</h1>
        </header>

        <nav class="mb-6 bg-white p-3 rounded-lg shadow">
            <ul class="flex flex-wrap justify-center gap-2">
                <li><button class="nav-button px-4 py-2 bg-amber-200 text-amber-800 rounded-md font-semibold" data-target="overview">å‚³è¼¸å±¤æ¦‚è¦½</button></li>
                <li><button class="nav-button px-4 py-2 bg-amber-200 text-amber-800 rounded-md font-semibold" data-target="mux-demux">å¤šå·¥/è§£å¤šå·¥</button></li>
                <li><button class="nav-button px-4 py-2 bg-amber-200 text-amber-800 rounded-md font-semibold" data-target="udp">UDP å”å®š</button></li>
                <li><button class="nav-button px-4 py-2 bg-amber-200 text-amber-800 rounded-md font-semibold" data-target="rdt">å¯é è³‡æ–™å‚³è¼¸</button></li>
                <li><button class="nav-button px-4 py-2 bg-amber-200 text-amber-800 rounded-md font-semibold" data-target="tcp">TCP å”å®š</button></li>
                <li><button class="nav-button px-4 py-2 bg-amber-200 text-amber-800 rounded-md font-semibold" data-target="congestion-principles">æ“å¡æ§åˆ¶åŸç†</button></li>
                <li><button class="nav-button px-4 py-2 bg-amber-200 text-amber-800 rounded-md font-semibold" data-target="tcp-congestion">TCP æ“å¡æ§åˆ¶</button></li>
                <li><button class="nav-button px-4 py-2 bg-amber-200 text-amber-800 rounded-md font-semibold" data-target="evolution">å‚³è¼¸å±¤æ¼”é€²</button></li>
            </ul>
        </nav>

        <main id="main-content" class="bg-white p-6 rounded-lg shadow-lg min-h-[60vh]">
            <section id="overview" class="content-section active">
                <h2 class="text-2xl font-bold mb-4 text-amber-700">å‚³è¼¸å±¤æ¦‚è¦½</h2>
                <p class="mb-3">æœ¬ç¯€ä»‹ç´¹å‚³è¼¸å±¤åœ¨ç¶²è·¯æ¨¡å‹ä¸­çš„è§’è‰²ã€æä¾›çš„æ ¸å¿ƒæœå‹™ï¼Œä»¥åŠå®ƒèˆ‡ç¶²è·¯å±¤çš„å€åˆ¥ã€‚å‚³è¼¸å±¤è² è²¬æä¾›æ‡‰ç”¨ç¨‹å¼è¡Œç¨‹ä¹‹é–“çš„é‚è¼¯é€šè¨Šã€‚</p>
                <h3 class="text-xl font-semibold mb-2 text-amber-600">æ ¸å¿ƒæœå‹™</h3>
                <ul class="list-disc list-inside mb-3 space-y-1">
                    <li><strong class="font-semibold">å¤šå·¥ (Multiplexing) èˆ‡è§£å¤šå·¥ (Demultiplexing):</strong> å…è¨±åœ¨å–®ä¸€ä¸»æ©Ÿä¸ŠåŒæ™‚é‹è¡Œå¤šå€‹ç¶²è·¯æ‡‰ç”¨ã€‚</li>
                    <li><strong class="font-semibold">å¯é è³‡æ–™å‚³è¼¸ (Reliable Data Transfer):</strong> ç¢ºä¿è³‡æ–™ç„¡å·®éŒ¯ã€æŒ‰é †åºã€ç„¡ä¸Ÿå¤±åœ°å¾ç™¼é€æ–¹å‚³åˆ°æ¥æ”¶æ–¹ (ä¸»è¦ç”± TCP æä¾›)ã€‚</li>
                    <li><strong class="font-semibold">æµé‡æ§åˆ¶ (Flow Control):</strong> é˜²æ­¢ç™¼é€æ–¹ç™¼é€éå¤šè³‡æ–™æ·¹æ²’æ¥æ”¶æ–¹ã€‚</li>
                    <li><strong class="font-semibold">æ“å¡æ§åˆ¶ (Congestion Control):</strong> ç•¶ç¶²è·¯ç™¼ç”Ÿæ“å¡æ™‚ï¼Œèª¿ç¯€ç™¼é€æ–¹çš„ç™¼é€é€Ÿç‡ã€‚</li>
                </ul>
                <h3 class="text-xl font-semibold mb-2 text-amber-600">å‚³è¼¸å±¤ vs. ç¶²è·¯å±¤</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-amber-200 rounded-lg">
                        <thead>
                            <tr class="bg-amber-100">
                                <th class="py-2 px-4 border-b border-amber-200 text-left">ç‰¹æ€§</th>
                                <th class="py-2 px-4 border-b border-amber-200 text-left">å‚³è¼¸å±¤</th>
                                <th class="py-2 px-4 border-b border-amber-200 text-left">ç¶²è·¯å±¤</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="py-2 px-4 border-b border-amber-200">é€šè¨Šç¯„åœ</td>
                                <td class="py-2 px-4 border-b border-amber-200">è¡Œç¨‹åˆ°è¡Œç¨‹ (Process-to-process)</td>
                                <td class="py-2 px-4 border-b border-amber-200">ä¸»æ©Ÿåˆ°ä¸»æ©Ÿ (Host-to-host)</td>
                            </tr>
                            <tr>
                                <td class="py-2 px-4 border-b border-amber-200">æä¾›çš„æœå‹™</td>
                                <td class="py-2 px-4 border-b border-amber-200">é‚è¼¯é€šè¨Šã€å¯é æ€§ã€æµé‡æ§åˆ¶ã€æ“å¡æ§åˆ¶</td>
                                <td class="py-2 px-4 border-b border-amber-200">ä¸»æ©Ÿé–“è³‡æ–™åŒ…è·¯ç”±èˆ‡è½‰ç™¼</td>
                            </tr>
                            <tr>
                                <td class="py-2 px-4 border-b border-amber-200">å®¶åº­é¡æ¯”</td>
                                <td class="py-2 px-4 border-b border-amber-200">Ann å®¶çš„å­©å­å¯«ä¿¡çµ¦ Bill å®¶çš„ç‰¹å®šå­©å­ (å­©å­ = è¡Œç¨‹)</td>
                                <td class="py-2 px-4 border-b border-amber-200">éƒµæ”¿æœå‹™å°‡ä¿¡ä»¶å¾ Ann å®¶é€åˆ° Bill å®¶ (æˆ¿å­ = ä¸»æ©Ÿ)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <p class="mt-4">å‚³è¼¸å±¤å”å®šåœ¨ç«¯ç³»çµ±ä¸­é‹ä½œã€‚ç™¼é€æ–¹å°‡æ‡‰ç”¨ç¨‹å¼è¨Šæ¯åˆ†è§£ç‚ºåˆ†æ®µ (segments)ï¼Œå‚³éçµ¦ç¶²è·¯å±¤ï¼›æ¥æ”¶æ–¹å‰‡å°‡åˆ†æ®µé‡çµ„ç‚ºè¨Šæ¯ï¼Œå‚³éçµ¦æ‡‰ç”¨å±¤ã€‚ç¶²éš›ç¶²è·¯ä¸­ä¸»è¦çš„å‚³è¼¸å”å®šæ˜¯ TCP å’Œ UDPã€‚</p>
            </section>

            <section id="mux-demux" class="content-section">
                <h2 class="text-2xl font-bold mb-4 text-amber-700">å¤šå·¥èˆ‡è§£å¤šå·¥</h2>
                <p class="mb-3">å¤šå·¥èˆ‡è§£å¤šå·¥æ˜¯å‚³è¼¸å±¤çš„é—œéµåŠŸèƒ½ï¼Œä½¿å¾—å¤šå€‹æ‡‰ç”¨ç¨‹å¼å¯ä»¥å…±äº«ç¶²è·¯é€£æ¥ã€‚ç™¼é€ç«¯åŸ·è¡Œå¤šå·¥ï¼Œæ¥æ”¶ç«¯åŸ·è¡Œè§£å¤šå·¥ã€‚</p>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="diagram-box">
                        <h3 class="text-xl font-semibold mb-2 text-amber-600">å¤šå·¥ (Multiplexing)</h3>
                        <p>åœ¨ç™¼é€ç«¯ï¼Œå‚³è¼¸å±¤å¾å¤šå€‹æ‡‰ç”¨ç¨‹å¼çš„ sockets æ”¶é›†è³‡æ–™å€å¡Šï¼Œç‚ºæ¯å€‹å€å¡Šæ·»åŠ å ±é ­è³‡è¨Š (ä¾‹å¦‚ä¾†æºåŸ è™Ÿå’Œç›®çš„åŸ è™Ÿ)ï¼Œç„¶å¾Œå°‡å½¢æˆçš„åˆ†æ®µå‚³éçµ¦ç¶²è·¯å±¤ã€‚</p>
                        <div class="mt-2 p-2 border border-dashed border-amber-400 rounded text-center">
                            æ‡‰ç”¨ P1 Socket â†’<br>
                            æ‡‰ç”¨ P2 Socket â†’ <span class="text-2xl font-bold mx-2">&searr;</span> å‚³è¼¸å±¤ <span class="text-2xl font-bold mx-2">&searr;</span> ç¶²è·¯å±¤<br>
                            æ‡‰ç”¨ P3 Socket â†’
                        </div>
                    </div>
                    <div class="diagram-box">
                        <h3 class="text-xl font-semibold mb-2 text-amber-600">è§£å¤šå·¥ (Demultiplexing)</h3>
                        <p>åœ¨æ¥æ”¶ç«¯ï¼Œå‚³è¼¸å±¤æª¢æŸ¥åˆ°é”åˆ†æ®µçš„å ±é ­æ¬„ä½ï¼Œå°‡æ¯å€‹åˆ†æ®µçš„å…§å®¹å°å‘åˆ°æ­£ç¢ºçš„æ‡‰ç”¨ç¨‹å¼ socketã€‚é€™æ˜¯é€éä½¿ç”¨åŸ è™Ÿä¾†å¯¦ç¾çš„ã€‚</p>
                         <div class="mt-2 p-2 border border-dashed border-amber-400 rounded text-center">
                            ç¶²è·¯å±¤ <span class="text-2xl font-bold mx-2">&searr;</span> å‚³è¼¸å±¤ <span class="text-2xl font-bold mx-2">&searr;</span> <br>
                            <span class="text-2xl font-bold mx-2">&nearr;</span> Socket æ‡‰ç”¨ P1<br>
                            <span class="text-2xl font-bold mx-2">&nearr;</span> Socket æ‡‰ç”¨ P2<br>
                            <span class="text-2xl font-bold mx-2">&nearr;</span> Socket æ‡‰ç”¨ P3
                        </div>
                    </div>
                </div>
                <h3 class="text-xl font-semibold mt-4 mb-2 text-amber-600">è§£å¤šå·¥æ–¹å¼</h3>
                <ul class="list-disc list-inside mb-3 space-y-1">
                    <li><strong class="font-semibold">ç„¡é€£æ¥è§£å¤šå·¥ (UDP):</strong> æ¥æ”¶ä¸»æ©Ÿåƒ…ä½¿ç”¨ UDP åˆ†æ®µä¸­çš„ã€Œç›®çš„åŸ è™Ÿã€ä¾†å°‡åˆ†æ®µå°å‘åˆ°ç›¸æ‡‰çš„ socketã€‚ä¾†è‡ªä¸åŒä¾†æº IP æˆ–ä¾†æºåŸ è™Ÿä½†å…·æœ‰ç›¸åŒç›®çš„åŸ è™Ÿçš„ UDP åˆ†æ®µå°‡è¢«å°å‘åˆ°åŒä¸€å€‹ socketã€‚</li>
                    <li><strong class="font-semibold">é¢å‘é€£æ¥è§£å¤šå·¥ (TCP):</strong> TCP socket ç”±ä¸€å€‹å››å…ƒçµ„å”¯ä¸€è­˜åˆ¥ï¼š(ä¾†æº IP ä½å€, ä¾†æºåŸ è™Ÿ, ç›®çš„ IP ä½å€, ç›®çš„åŸ è™Ÿ)ã€‚æ¥æ”¶ç«¯ä½¿ç”¨é€™æ‰€æœ‰å››å€‹å€¼ä¾†å°‡ TCP åˆ†æ®µå°å‘åˆ°æ­£ç¢ºçš„ socketã€‚é€™å…è¨±å¤šå€‹å®¢æˆ¶ç«¯åŒæ™‚é€£æ¥åˆ°åŒä¸€å€‹ä¼ºæœå™¨è¡Œç¨‹çš„ä¸åŒ socketã€‚</li>
                </ul>
            </section>

            <section id="udp" class="content-section">
                <h2 class="text-2xl font-bold mb-4 text-amber-700">UDP å”å®š (User Datagram Protocol)</h2>
                <p class="mb-3">UDP æ˜¯ä¸€ç¨®ã€Œç„¡ä¿®é£¾ã€ã€æ¥µç°¡çš„ç¶²éš›ç¶²è·¯å‚³è¼¸å”å®šã€‚å®ƒæä¾›ã€Œç›¡åŠ›è€Œç‚ºã€çš„æœå‹™ï¼ŒUDP åˆ†æ®µå¯èƒ½æœƒä¸Ÿå¤±ï¼Œä¹Ÿå¯èƒ½ç„¡åºåœ°å‚³éçµ¦æ‡‰ç”¨ç¨‹å¼ã€‚</p>
                <h3 class="text-xl font-semibold mb-2 text-amber-600">UDP ç‰¹æ€§</h3>
                <ul class="list-disc list-inside mb-3 space-y-1">
                    <li><strong class="font-semibold">ç„¡é€£æ¥:</strong> åœ¨ UDP ç™¼é€æ–¹å’Œæ¥æ”¶æ–¹ä¹‹é–“æ²’æœ‰æ¡æ‰‹éç¨‹ï¼Œæ¯å€‹ UDP åˆ†æ®µéƒ½ç¨ç«‹è™•ç†ã€‚</li>
                    <li><strong class="font-semibold">ç„¡é€£æ¥å»ºç«‹å»¶é²:</strong> ä¸éœ€è¦åƒ TCP é‚£æ¨£é€²è¡Œé€£æ¥è¨­å®šï¼Œå¯ä»¥æ¸›å°‘å»¶é²ã€‚</li>
                    <li><strong class="font-semibold">ç°¡å–®:</strong> ç™¼é€æ–¹å’Œæ¥æ”¶æ–¹éƒ½ç„¡éœ€ç¶­è­·é€£æ¥ç‹€æ…‹ã€‚</li>
                    <li><strong class="font-semibold">å°å ±é ­:</strong> UDP å ±é ­åªæœ‰ 8 å€‹ä½å…ƒçµ„ã€‚</li>
                    <li><strong class="font-semibold">ç„¡æ“å¡æ§åˆ¶:</strong> UDP å¯ä»¥æŒ‰ç…§æ‡‰ç”¨ç¨‹å¼æœŸæœ›çš„é€Ÿç‡ç™¼é€è³‡æ–™ï¼Œå³ä½¿ç¶²è·¯æ“å¡ä¹Ÿä¸æœƒä¸»å‹•æ¸›é€Ÿã€‚</li>
                </ul>
                <h3 class="text-xl font-semibold mb-2 text-amber-600">UDP åˆ†æ®µçµæ§‹</h3>
                <div class="diagram-box overflow-x-auto">
                    <p class="text-sm mb-1 text-center">é»æ“Šæ¬„ä½æŸ¥çœ‹èªªæ˜</p>
                    <table class="min-w-full border-collapse border border-amber-300">
                        <thead>
                            <tr>
                                <th colspan="2" class="border border-amber-300 p-2 bg-amber-100">0-15 ä½å…ƒ</th>
                                <th colspan="2" class="border border-amber-300 p-2 bg-amber-100">16-31 ä½å…ƒ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="2" class="tcp-segment-field border border-amber-300 p-2 text-center" data-description="ä¾†æºæ‡‰ç”¨ç¨‹å¼çš„åŸ è™Ÿ (é¸ç”¨)">ä¾†æºåŸ è™Ÿ</td>
                                <td colspan="2" class="tcp-segment-field border border-amber-300 p-2 text-center" data-description="ç›®çš„æ‡‰ç”¨ç¨‹å¼çš„åŸ è™Ÿ (å¿…è¦)">ç›®çš„åŸ è™Ÿ</td>
                            </tr>
                            <tr>
                                <td colspan="2" class="tcp-segment-field border border-amber-300 p-2 text-center" data-description="UDP åˆ†æ®µçš„é•·åº¦ (åŒ…æ‹¬å ±é ­å’Œè³‡æ–™)ï¼Œä»¥ä½å…ƒçµ„ç‚ºå–®ä½">é•·åº¦</td>
                                <td colspan="2" class="tcp-segment-field border border-amber-300 p-2 text-center" data-description="ç”¨æ–¼æª¢æ¸¬ UDP åˆ†æ®µåœ¨å‚³è¼¸éç¨‹ä¸­æ˜¯å¦ç™¼ç”Ÿä½å…ƒéŒ¯èª¤">æ ¡é©—å’Œ</td>
                            </tr>
                            <tr>
                                <td colspan="4" class="tcp-segment-field border border-amber-300 p-8 text-center bg-amber-50" data-description="ä¾†è‡ªæ‡‰ç”¨å±¤çš„è³‡æ–™">æ‡‰ç”¨è³‡æ–™ (è² è¼‰)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="udp-field-description-tooltip" class="tooltip"></div>

                <h3 class="text-xl font-semibold mt-4 mb-2 text-amber-600">UDP æ ¡é©—å’Œ</h3>
                <p class="mb-3">UDP æ ¡é©—å’Œç”¨æ–¼æª¢æ¸¬åˆ†æ®µåœ¨å‚³è¼¸éç¨‹ä¸­æ˜¯å¦ç™¼ç”Ÿäº†ä½å…ƒéŒ¯èª¤ã€‚ç™¼é€æ–¹è¨ˆç®—æ ¡é©—å’Œä¸¦å°‡å…¶æ”¾å…¥æ ¡é©—å’Œæ¬„ä½ã€‚æ¥æ”¶æ–¹é‡æ–°è¨ˆç®—æ ¡é©—å’Œï¼Œå¦‚æœè¨ˆç®—çµæœèˆ‡æ¥æ”¶åˆ°çš„æ ¡é©—å’Œæ¬„ä½å€¼ä¸ç¬¦ï¼Œå‰‡æª¢æ¸¬åˆ°éŒ¯èª¤ã€‚</p>
                <p class="mb-3">è¨ˆç®—æ–¹æ³•ï¼šå°‡ UDP åˆ†æ®µçš„å…§å®¹ (åŒ…æ‹¬å½å ±é ­ã€UDP å ±é ­å’Œè³‡æ–™) è¦–ç‚ºä¸€ç³»åˆ— 16 ä½å…ƒçš„æ•´æ•¸ï¼Œå°é€™äº›æ•´æ•¸é€²è¡Œä¸€è£œæ•¸å’Œé‹ç®—ã€‚å¦‚æœåŠ æ³•éç¨‹ä¸­æœ€é«˜ä½ç”¢ç”Ÿé€²ä½ï¼Œå‰‡è©²é€²ä½å¿…é ˆåŠ å›åˆ°çµæœçš„æœ€ä½ä½ (å›æ²)ã€‚æ ¡é©—å’Œæ¬„ä½æœ¬èº«åœ¨è¨ˆç®—æ™‚è¢«è¦–ç‚º 0ã€‚</p>
                <p class="text-sm text-gray-600">æ³¨æ„ï¼šUDP æ ¡é©—å’Œæ˜¯é¸ç”¨çš„ (åœ¨ IPv4 ä¸­)ã€‚å¦‚æœç™¼é€æ–¹ä¸è¨ˆç®—æ ¡é©—å’Œï¼Œå‰‡è©²æ¬„ä½å…¨ç‚º 0ã€‚ç„¶è€Œï¼Œå¼·çƒˆå»ºè­°ä½¿ç”¨æ ¡é©—å’Œã€‚</p>

                <h3 class="text-xl font-semibold mt-4 mb-2 text-amber-600">UDP ç”¨é€”</h3>
                <p>UDPå¸¸ç”¨æ–¼å°å»¶é²æ•æ„Ÿã€èƒ½å®¹å¿å°‘é‡ä¸ŸåŒ…çš„æ‡‰ç”¨ï¼Œä¾‹å¦‚ï¼š</p>
                <ul class="list-disc list-inside space-y-1">
                    <li>ä¸²æµå¤šåª’é«” (å¦‚è¦–è¨Šã€éŸ³è¨Šæœƒè­°)</li>
                    <li>DNS (åŸŸåç³»çµ±)</li>
                    <li>SNMP (ç°¡å–®ç¶²è·¯ç®¡ç†å”å®š)</li>
                    <li>HTTP/3 (QUIC å”å®šä½¿ç”¨ UDP ä½œç‚ºåº•å±¤å‚³è¼¸)</li>
                </ul>
                 <p class="mt-2">å¦‚æœæ‡‰ç”¨ç¨‹å¼éœ€è¦åŸºæ–¼ UDP çš„å¯é å‚³è¼¸ï¼Œå‰‡å¿…é ˆåœ¨æ‡‰ç”¨å±¤è‡ªè¡Œå¯¦ç¾å¯é æ€§æ©Ÿåˆ¶ã€‚</p>
            </section>

            <section id="rdt" class="content-section">
                <h2 class="text-2xl font-bold mb-4 text-amber-700">å¯é è³‡æ–™å‚³è¼¸åŸç† (RDT)</h2>
                <p class="mb-3">å¯é è³‡æ–™å‚³è¼¸æ˜¯å‚³è¼¸å±¤çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œç›®æ¨™æ˜¯ç¢ºä¿è³‡æ–™èƒ½å¤ ç„¡å·®éŒ¯ã€æŒ‰é †åºã€ç„¡ä¸Ÿå¤±åœ°å¾ç™¼é€æ–¹å‚³éåˆ°æ¥æ”¶æ–¹ï¼Œå³ä½¿åº•å±¤ç¶²è·¯é€šé“æœ¬èº«æ˜¯ä¸å¯é çš„ã€‚æˆ‘å€‘å°‡é€æ­¥æ¢è¨ rdt å”è­°çš„è¨­è¨ˆã€‚</p>

                <div class="mb-4 p-3 bg-amber-50 rounded-lg border border-amber-200">
                    <h3 class="text-lg font-semibold text-amber-600">RDT 1.0: å¯é é€šé“ä¸Šçš„å¯é å‚³è¼¸</h3>
                    <p class="text-sm">å‡è¨­åº•å±¤é€šé“å®Œç¾å¯é  (ç„¡ä½å…ƒéŒ¯èª¤ã€ç„¡å°åŒ…éºå¤±)ã€‚</p>
                    <div class="flex justify-around mt-2">
                        <div class="fsm-state w-1/3"><strong>ç™¼é€æ–¹</strong><br>ç­‰å¾…ä¸Šå±¤å‘¼å«<br><small>rdt_send(data) â†’ udt_send(packet)</small></div>
                        <div class="fsm-arrow self-center">&rarr;</div>
                        <div class="fsm-state w-1/3"><strong>æ¥æ”¶æ–¹</strong><br>ç­‰å¾…ä¸‹å±¤å‘¼å«<br><small>rdt_rcv(packet) â†’ deliver_data(data)</small></div>
                    </div>
                    <p class="text-xs mt-1 text-center">é€™æ˜¯æœ€ç°¡å–®çš„æƒ…æ³ï¼Œç™¼é€æ–¹ç™¼é€ï¼Œæ¥æ”¶æ–¹æ¥æ”¶ã€‚</p>
                </div>

                <div class="mb-4 p-3 bg-amber-50 rounded-lg border border-amber-200">
                    <h3 class="text-lg font-semibold text-amber-600">RDT 2.0: å…·æœ‰ä½å…ƒéŒ¯èª¤çš„é€šé“</h3>
                    <p class="text-sm">åº•å±¤é€šé“å¯èƒ½ç¿»è½‰å°åŒ…ä¸­çš„ä½å…ƒã€‚ä½¿ç”¨æ ¡é©—å’Œæª¢æ¸¬éŒ¯èª¤ã€‚å¼•å…¥ ACK (ç¢ºèª) å’Œ NAK (å¦å®šç¢ºèª) ä¾†é€²è¡ŒéŒ¯èª¤æ¢å¾©ã€‚é€™æ˜¯ä¸€ç¨®åœæ­¢ç­‰å¾…å”è­°ã€‚</p>
                    <p class="text-xs mt-1"><strong>å•é¡Œ:</strong> å¦‚æœ ACK/NAK æœ¬èº«æå£æ€éº¼è¾¦ï¼Ÿç™¼é€æ–¹ç„¡æ³•çŸ¥é“æ¥æ”¶æ–¹çš„ç‹€æ…‹ã€‚</p>
                </div>
                
                <div class="mb-4 p-3 bg-amber-50 rounded-lg border border-amber-200">
                    <h3 class="text-lg font-semibold text-amber-600">RDT 2.1: è™•ç†æå£çš„ ACK/NAK</h3>
                    <p class="text-sm">ç™¼é€æ–¹ç‚ºæ¯å€‹å°åŒ…æ·»åŠ åºåˆ—è™Ÿ (ä¾‹å¦‚ 0 å’Œ 1 äº¤æ›¿)ã€‚æ¥æ”¶æ–¹ä¸Ÿæ£„é‡è¤‡çš„å°åŒ…ã€‚ç™¼é€æ–¹é‡å‚³æå£ ACK/NAK å°æ‡‰çš„å°åŒ…ã€‚</p>
                </div>

                <div class="mb-4 p-3 bg-amber-50 rounded-lg border border-amber-200">
                    <h3 class="text-lg font-semibold text-amber-600">RDT 2.2: ç„¡ NAK çš„å”è­°</h3>
                    <p class="text-sm">èˆ‡ rdt2.1 åŠŸèƒ½ç›¸åŒï¼Œä½†åƒ…ä½¿ç”¨ ACKã€‚æ¥æ”¶æ–¹ç™¼é€å°æœ€å¾Œæ­£ç¢ºæ”¶åˆ°çš„ã€æŒ‰åºå°åŒ…çš„ ACK (åŒ…å«åºåˆ—è™Ÿ)ã€‚ç™¼é€æ–¹æ”¶åˆ°é‡è¤‡çš„ ACK (è¡¨ç¤ºå…¶å¾Œçš„å°åŒ…æœªæ”¶åˆ°) æ™‚ï¼Œè¡Œç‚ºé¡ä¼¼æ–¼æ”¶åˆ° NAKï¼Œå³é‡å‚³ç•¶å‰å°åŒ…ã€‚</p>
                </div>

                <div class="mb-4 p-3 bg-amber-50 rounded-lg border border-amber-200">
                    <h3 class="text-lg font-semibold text-amber-600">RDT 3.0: å…·æœ‰éŒ¯èª¤å’Œéºå¤±çš„é€šé“</h3>
                    <p class="text-sm">åº•å±¤é€šé“ä¸åƒ…å¯èƒ½ç”¢ç”Ÿä½å…ƒéŒ¯èª¤ï¼Œé‚„å¯èƒ½éºå¤±å°åŒ… (è³‡æ–™å°åŒ…æˆ– ACK å°åŒ…)ã€‚ç™¼é€æ–¹ç­‰å¾…ã€Œåˆç†ã€æ™‚é–“ä»¥æ¥æ”¶ ACKï¼Œå¦‚æœè¶…æ™‚å‰‡é‡å‚³å°åŒ…ã€‚åºåˆ—è™Ÿè™•ç†é‡è¤‡å•é¡Œã€‚</p>
                    <p class="text-xs mt-1"><strong>åœæ­¢ç­‰å¾…çš„æ€§èƒ½:</strong> $U_{sender} = (L/R) / (RTT + L/R)$ã€‚å°æ–¼é«˜é »å¯¬å»¶é²ç¶²è·¯ï¼Œåˆ©ç”¨ç‡æ¥µä½ã€‚</p>
                </div>

                <h3 class="text-xl font-semibold mt-4 mb-2 text-amber-600">ç®¡ç·šåŒ–å”è­° (Pipelining)</h3>
                <p class="mb-3">ç‚ºäº†è§£æ±ºåœæ­¢ç­‰å¾…å”è­°çš„æ€§èƒ½ç“¶é ¸ï¼Œå¼•å…¥äº†ç®¡ç·šåŒ–æŠ€è¡“ã€‚ç™¼é€æ–¹å…è¨±ç™¼é€å¤šå€‹ã€Œåœ¨é€”ã€(in-flight)ã€å°šæœªç¢ºèªçš„å°åŒ…ï¼Œå¾è€Œé¡¯è‘—æé«˜éˆè·¯åˆ©ç”¨ç‡ã€‚</p>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="diagram-box">
                        <h4 class="text-lg font-semibold text-amber-600">Go-Back-N (GBN)</h4>
                        <p class="text-sm">ç™¼é€æ–¹ç¶­è­·ä¸€å€‹å¤§å°ç‚º N çš„çª—å£ï¼Œå…è¨±æœ€å¤š N å€‹å·²ç™¼é€ä½†æœªç¢ºèªçš„å°åŒ…ã€‚ä½¿ç”¨ç´¯è¨ˆç¢ºèªï¼šACK(n) ç¢ºèªæ‰€æœ‰åºåˆ—è™Ÿç›´åˆ° n (åŒ…æ‹¬ n) çš„å°åŒ…éƒ½å·²æ­£ç¢ºæ¥æ”¶ã€‚å¦‚æœç™¼ç”Ÿè¶…æ™‚ï¼Œç™¼é€æ–¹æœƒé‡å‚³è¶…æ™‚å°åŒ…ä»¥åŠçª—å£ä¸­æ‰€æœ‰æ›´é«˜åºåˆ—è™Ÿçš„å°åŒ…ã€‚æ¥æ”¶æ–¹åªæ¥æ”¶æŒ‰åºåˆ°é”çš„å°åŒ…ï¼Œä¸Ÿæ£„æ‰€æœ‰å¤±åºå°åŒ…ï¼Œä¸¦ç‚ºæ­£ç¢ºæŒ‰åºæ”¶åˆ°çš„æœ€é«˜åºåˆ—è™Ÿå°åŒ…ç™¼é€ ACKã€‚</p>
                    </div>
                    <div class="diagram-box">
                        <h4 class="text-lg font-semibold text-amber-600">Selective Repeat (SR)</h4>
                        <p class="text-sm">æ¥æ”¶æ–¹å–®ç¨ç¢ºèªæ‰€æœ‰æ­£ç¢ºæ”¶åˆ°çš„å°åŒ…ï¼Œå³ä½¿å®ƒå€‘æ˜¯å¤±åºçš„ï¼Œä¸¦ç·©å­˜å¤±åºå°åŒ…ï¼Œç›´åˆ°æ‰€æœ‰å‰é¢çš„å°åŒ…éƒ½åˆ°é”å¾Œå†æŒ‰åºäº¤ä»˜çµ¦ä¸Šå±¤ã€‚ç™¼é€æ–¹ä¹Ÿç‚ºæ¯å€‹æœªç¢ºèªçš„å°åŒ…ç¶­è­·ä¸€å€‹ç¨ç«‹çš„è¨ˆæ™‚å™¨ã€‚ç•¶æŸå€‹å°åŒ…è¶…æ™‚æ™‚ï¼Œåƒ…é‡å‚³è©²ç‰¹å®šå°åŒ…ã€‚é€™æ¯” GBN æ›´æœ‰æ•ˆç‡ï¼Œä½†å¯¦ç¾æ›´è¤‡é›œã€‚SR éœ€è¦ä»”ç´°è¨­è¨ˆåºåˆ—è™Ÿç©ºé–“å’Œçª—å£å¤§å°ä»¥é¿å…æ­§ç¾© (å…©é›£å•é¡Œ)ã€‚</p>
                    </div>
                </div>
                 <p class="mt-3 text-sm">ç®¡ç·šåŒ–å”è­°éœ€è¦æ›´å¤§çš„åºåˆ—è™Ÿç©ºé–“å’Œåœ¨ç™¼é€æ–¹/æ¥æ”¶æ–¹çš„ç·©è¡æ©Ÿåˆ¶ã€‚</p>
            </section>

            <section id="tcp" class="content-section">
                <h2 class="text-2xl font-bold mb-4 text-amber-700">TCP å”å®š (Transmission Control Protocol)</h2>
                <p class="mb-3">TCP æ˜¯ç¶²éš›ç¶²è·¯æ ¸å¿ƒå”å®šä¹‹ä¸€ï¼Œæä¾›å¯é çš„ã€é¢å‘é€£æ¥çš„ã€åŸºæ–¼ä½å…ƒçµ„æµçš„å‚³è¼¸æœå‹™ã€‚å®ƒåŒ…å«è¤‡é›œçš„æ©Ÿåˆ¶ä¾†ç¢ºä¿è³‡æ–™çš„å¯é äº¤ä»˜ã€é€²è¡Œæµé‡æ§åˆ¶å’Œæ“å¡æ§åˆ¶ã€‚</p>
                
                <h3 class="text-xl font-semibold mb-2 text-amber-600">TCP åˆ†æ®µçµæ§‹</h3>
                <div class="diagram-box overflow-x-auto">
                     <p class="text-sm mb-1 text-center">é»æ“Šæ¬„ä½æŸ¥çœ‹èªªæ˜</p>
                    <table class="min-w-full border-collapse border border-amber-300 text-xs md:text-sm">
                        <tbody>
                            <tr>
                                <td colspan="4" class="tcp-segment-field border p-1 text-center" data-description="ä¾†æºæ‡‰ç”¨ç¨‹å¼çš„åŸ è™Ÿ">ä¾†æºåŸ è™Ÿ (16ä½å…ƒ)</td>
                                <td colspan="4" class="tcp-segment-field border p-1 text-center" data-description="ç›®çš„æ‡‰ç”¨ç¨‹å¼çš„åŸ è™Ÿ">ç›®çš„åŸ è™Ÿ (16ä½å…ƒ)</td>
                            </tr>
                            <tr>
                                <td colspan="8" class="tcp-segment-field border p-1 text-center" data-description="æ­¤åˆ†æ®µä¸­ç¬¬ä¸€å€‹è³‡æ–™ä½å…ƒçµ„åœ¨ä½å…ƒçµ„æµä¸­çš„åºåˆ—è™Ÿ">åºåˆ—è™Ÿ (32ä½å…ƒ)</td>
                            </tr>
                            <tr>
                                <td colspan="8" class="tcp-segment-field border p-1 text-center" data-description="æœŸæœ›å¾å°æ–¹æ¥æ”¶çš„ä¸‹ä¸€å€‹ä½å…ƒçµ„çš„åºåˆ—è™Ÿ (è‹¥ACKä½å…ƒè¨­å®š)">ç¢ºèªè™Ÿ (32ä½å…ƒ)</td>
                            </tr>
                            <tr>
                                <td class="tcp-segment-field border p-1 text-center" data-description="TCPå ±é ­é•·åº¦(ä»¥4ä½å…ƒçµ„ç‚ºå–®ä½)">HLEN (4ä½)</td>
                                <td colspan="3" class="tcp-segment-field border p-1 text-center" data-description="ä¿ç•™ä¾›å°‡ä¾†ä½¿ç”¨ (æ‡‰ç‚º0)">ä¿ç•™ (6ä½)</td>
                                <td class="tcp-segment-field border p-1 text-center" data-description="ECN-Nonce (æ“å¡é€šçŸ¥)">N</td>
                                <td class="tcp-segment-field border p-1 text-center" data-description="Congestion Window Reduced (æ“å¡çª—å£æ¸›å°‘)">C</td>
                                <td class="tcp-segment-field border p-1 text-center" data-description="ECN-Echo (æ˜ç¢ºæ“å¡é€šçŸ¥å›æ‡‰)">E</td>
                                <td class="tcp-segment-field border p-1 text-center" data-description="Urgent Pointer field significant (ç·Šæ€¥æŒ‡æ¨™æœ‰æ•ˆ)">U</td>
                            </tr>
                             <tr>
                                <td class="tcp-segment-field border p-1 text-center" data-description="Acknowledgement field significant (ç¢ºèªæ¬„ä½æœ‰æ•ˆ)">A</td>
                                <td class="tcp-segment-field border p-1 text-center" data-description="Push function (æ¨é€åŠŸèƒ½)">P</td>
                                <td class="tcp-segment-field border p-1 text-center" data-description="Reset the connection (é‡ç½®é€£æ¥)">R</td>
                                <td class="tcp-segment-field border p-1 text-center" data-description="Synchronize sequence numbers (åŒæ­¥åºåˆ—è™Ÿï¼Œç”¨æ–¼é€£æ¥å»ºç«‹)">S</td>
                                <td class="tcp-segment-field border p-1 text-center" data-description="No more data from sender (çµ‚æ­¢é€£æ¥)">F</td>
                                <td colspan="3" class="tcp-segment-field border p-1 text-center" data-description="æ¥æ”¶æ–¹é¡˜æ„æ¥å—çš„è³‡æ–™é‡ (ç”¨æ–¼æµé‡æ§åˆ¶)">æ¥æ”¶çª—å£ (rwnd, 16ä½å…ƒ)</td>
                            </tr>
                            <tr>
                                <td colspan="4" class="tcp-segment-field border p-1 text-center" data-description="å°TCPå ±é ­ã€è³‡æ–™å’Œå½å ±é ­è¨ˆç®—çš„æ ¡é©—å’Œ">æ ¡é©—å’Œ (16ä½å…ƒ)</td>
                                <td colspan="4" class="tcp-segment-field border p-1 text-center" data-description="æŒ‡å‘ç·Šæ€¥è³‡æ–™çš„æœ€å¾Œä¸€å€‹ä½å…ƒçµ„ (è‹¥URGä½å…ƒè¨­å®š)">ç·Šæ€¥æŒ‡æ¨™ (16ä½å…ƒ)</td>
                            </tr>
                            <tr>
                                <td colspan="8" class="tcp-segment-field border p-1 text-center" data-description="å¯é¸æ¬„ä½ï¼Œé•·åº¦å¯è®Š (ä¾‹å¦‚MSSé¸é …)">é¸é … (è‹¥æœ‰)</td>
                            </tr>
                             <tr>
                                <td colspan="8" class="tcp-segment-field border p-4 text-center bg-amber-50" data-description="æ‡‰ç”¨å±¤è³‡æ–™">æ‡‰ç”¨è³‡æ–™ (è² è¼‰)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="tcp-field-description-tooltip" class="tooltip"></div>

                <h3 class="text-xl font-semibold mt-4 mb-2 text-amber-600">TCP é€£æ¥ç®¡ç†ï¼šä¸‰æ¬¡æ¡æ‰‹</h3>
                <p class="mb-3">TCP åœ¨å‚³è¼¸è³‡æ–™ä¹‹å‰éœ€è¦å»ºç«‹é€£æ¥ã€‚é€™æ˜¯é€éã€Œä¸‰æ¬¡æ¡æ‰‹ã€éç¨‹å®Œæˆçš„ï¼š</p>
                <div id="three-way-handshake" class="space-y-2">
                    <div class="handshake-step p-3 bg-amber-50 rounded border border-amber-200"><strong>æ­¥é©Ÿ 1 (SYN):</strong> å®¢æˆ¶ç«¯ç™¼é€ä¸€å€‹ TCP åˆ†æ®µçµ¦ä¼ºæœå™¨ï¼Œå…¶ä¸­ SYN æ§åˆ¶ä½å…ƒè¨­ç‚º 1ï¼Œä¸¦é¸æ“‡ä¸€å€‹åˆå§‹åºåˆ—è™Ÿ (client_isn)ã€‚å®¢æˆ¶ç«¯é€²å…¥ SYN_SENT ç‹€æ…‹ã€‚</div>
                    <div class="handshake-step p-3 bg-amber-50 rounded border border-amber-200"><strong>æ­¥é©Ÿ 2 (SYN+ACK):</strong> ä¼ºæœå™¨æ”¶åˆ° SYN å¾Œï¼Œå¦‚æœåŒæ„é€£æ¥ï¼Œæœƒå›è¦†ä¸€å€‹ TCP åˆ†æ®µã€‚æ­¤åˆ†æ®µä¸­ SYN å’Œ ACK æ§åˆ¶ä½å…ƒéƒ½è¨­ç‚º 1ã€‚ä¼ºæœå™¨é¸æ“‡è‡ªå·±çš„åˆå§‹åºåˆ—è™Ÿ (server_isn)ï¼Œä¸¦å°‡ç¢ºèªè™Ÿè¨­ç‚º client_isn + 1ã€‚ä¼ºæœå™¨é€²å…¥ SYN_RCVD ç‹€æ…‹ã€‚</div>
                    <div class="handshake-step p-3 bg-amber-50 rounded border border-amber-200"><strong>æ­¥é©Ÿ 3 (ACK):</strong> å®¢æˆ¶ç«¯æ”¶åˆ°ä¼ºæœå™¨çš„ SYN+ACK åˆ†æ®µå¾Œï¼Œç™¼é€ä¸€å€‹ ACK åˆ†æ®µé€²è¡Œç¢ºèªã€‚æ­¤åˆ†æ®µä¸­ ACK æ§åˆ¶ä½å…ƒè¨­ç‚º 1ï¼Œç¢ºèªè™Ÿè¨­ç‚º server_isn + 1ã€‚é€£æ¥å»ºç«‹å®Œæˆï¼Œå®¢æˆ¶ç«¯å’Œä¼ºæœå™¨éƒ½é€²å…¥ ESTABLISHED ç‹€æ…‹ï¼Œå¯ä»¥é–‹å§‹å‚³è¼¸è³‡æ–™ã€‚</div>
                </div>
                <button id="animateHandshakeBtn" class="mt-3 px-4 py-2 bg-amber-500 text-white rounded hover:bg-amber-600">æ¼”ç¤ºä¸‰æ¬¡æ¡æ‰‹</button>

                <h3 class="text-xl font-semibold mt-4 mb-2 text-amber-600">TCP æµé‡æ§åˆ¶</h3>
                <p class="mb-3">TCP ä½¿ç”¨æµé‡æ§åˆ¶æ©Ÿåˆ¶ä¾†é˜²æ­¢å¿«é€Ÿçš„ç™¼é€æ–¹æ·¹æ²’æ…¢é€Ÿçš„æ¥æ”¶æ–¹ã€‚æ¥æ”¶æ–¹åœ¨å…¶ç™¼é€çµ¦ç™¼é€æ–¹çš„ TCP åˆ†æ®µçš„ã€Œæ¥æ”¶çª—å£ (rwnd)ã€æ¬„ä½ä¸­é€šå‘Šå…¶å¯ç”¨çš„ç·©è¡å€å¤§å°ã€‚ç™¼é€æ–¹ç¢ºä¿å…¶æœªç¢ºèªçš„åœ¨é€”è³‡æ–™é‡ä¸è¶…éæ¥æ”¶æ–¹é€šå‘Šçš„ rwnd å€¼ã€‚</p>
            </section>

            <section id="congestion-principles" class="content-section">
                <h2 class="text-2xl font-bold mb-4 text-amber-700">æ“å¡æ§åˆ¶åŸç†</h2>
                <p class="mb-3">æ“å¡æ˜¯æŒ‡ç¶²è·¯ä¸Šæœ‰å¤ªå¤šä¾†æºåŒæ™‚ç™¼é€å¤ªå¤šè³‡æ–™ï¼Œè¶…å‡ºäº†ç¶²è·¯çš„è™•ç†èƒ½åŠ›ã€‚é€™æœƒå°è‡´å°åŒ…åœ¨è·¯ç”±å™¨ç·©è¡å€ä¸­æ’é•·éšŠ (é•·å»¶é²) ç”šè‡³è¢«ä¸Ÿæ£„ (ç·©è¡å€æº¢ä½)ã€‚æ“å¡æ§åˆ¶èˆ‡æµé‡æ§åˆ¶ä¸åŒï¼Œå‰è€…æ˜¯é‡å°æ•´å€‹ç¶²è·¯çš„ç‹€æ³ï¼Œå¾Œè€…æ˜¯é‡å°å–®ä¸€æ¥æ”¶æ–¹çš„èƒ½åŠ›ã€‚</p>
                <h3 class="text-xl font-semibold mb-2 text-amber-600">æ“å¡çš„æˆæœ¬</h3>
                <ul class="list-disc list-inside mb-3 space-y-1">
                    <li><strong class="font-semibold">é•·å»¶é²:</strong> å°åŒ…åœ¨è·¯ç”±å™¨ç·©è¡å€ä¸­ç­‰å¾…æ™‚é–“éé•·ã€‚</li>
                    <li><strong class="font-semibold">å°åŒ…éºå¤±:</strong> è·¯ç”±å™¨ç·©è¡å€æ»¿æº¢å°è‡´æ–°åˆ°é”çš„å°åŒ…è¢«ä¸Ÿæ£„ã€‚</li>
                    <li><strong class="font-semibold">ååé‡ä¸‹é™:</strong> ç”±æ–¼é‡å‚³å’Œç¶²è·¯æ•ˆç‡é™ä½ï¼Œæœ‰æ•ˆååé‡å¯èƒ½é ä½æ–¼éˆè·¯å®¹é‡ã€‚</li>
                    <li><strong class="font-semibold">æµªè²»çš„å‚³è¼¸å®¹é‡:</strong> è¢«ä¸Ÿæ£„çš„å°åŒ…åœ¨ä¸Šæ¸¸éˆè·¯ä¸­æ¶ˆè€—çš„å‚³è¼¸è³‡æºè¢«æµªè²»äº†ã€‚</li>
                    <li><strong class="font-semibold">ä¸å¿…è¦çš„é‡å‚³:</strong> éæ—©è¶…æ™‚å¯èƒ½å°è‡´ä¸å¿…è¦çš„é‡å‚³ï¼Œé€²ä¸€æ­¥åŠ åŠ‡æ“å¡ã€‚</li>
                </ul>
                 <h3 class="text-xl font-semibold mb-2 text-amber-600">æ“å¡æ§åˆ¶æ–¹æ³•</h3>
                <ul class="list-disc list-inside mb-3 space-y-1">
                    <li><strong class="font-semibold">ç«¯åˆ°ç«¯æ“å¡æ§åˆ¶:</strong> ç¶²è·¯æœ¬èº«ä¸æä¾›æ˜ç¢ºçš„æ“å¡åé¥‹ã€‚å‚³è¼¸å±¤çš„ç™¼é€æ–¹é€éè§€å¯Ÿç¶²è·¯è¡Œç‚º (å¦‚å°åŒ…éºå¤±ã€å»¶é²å¢åŠ ) ä¾†æ¨æ–·æ“å¡æƒ…æ³ï¼Œä¸¦ç›¸æ‡‰èª¿æ•´å…¶ç™¼é€é€Ÿç‡ã€‚TCP ä¸»è¦æ¡ç”¨æ­¤æ–¹æ³•ã€‚</li>
                    <li><strong class="font-semibold">ç¶²è·¯è¼”åŠ©æ“å¡æ§åˆ¶:</strong> ç¶²è·¯ä¸­çš„è·¯ç”±å™¨ä¸»å‹•å‘ç™¼é€æ–¹æˆ–æ¥æ”¶æ–¹æä¾›é—œæ–¼æ“å¡ç‹€æ…‹çš„æ˜ç¢ºåé¥‹ã€‚ä¾‹å¦‚ï¼Œè·¯ç”±å™¨å¯ä»¥æ¨™è¨˜å°åŒ… (å¦‚ ECN)ï¼Œæˆ–ç›´æ¥å‘ŠçŸ¥ç™¼é€æ–¹æ‡‰ä½¿ç”¨çš„é€Ÿç‡ã€‚</li>
                </ul>
            </section>

            <section id="tcp-congestion" class="content-section">
                <h2 class="text-2xl font-bold mb-4 text-amber-700">TCP æ“å¡æ§åˆ¶</h2>
                <p class="mb-3">TCP ä½¿ç”¨ä¸€å¥—è¤‡é›œçš„æ©Ÿåˆ¶ä¾†æ§åˆ¶å…¶ç™¼é€é€Ÿç‡ï¼Œä»¥é©æ‡‰ç¶²è·¯çš„æ“å¡ç‹€æ³ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ã€Œæ¢æ¸¬ã€å¯ç”¨é »å¯¬ï¼Œä¸¦åœ¨æª¢æ¸¬åˆ°æ“å¡æ™‚æ¸›å°‘ç™¼é€é€Ÿç‡ã€‚</p>
                <h3 class="text-xl font-semibold mb-2 text-amber-600">æ“å¡çª—å£ (cwnd) èˆ‡ AIMD</h3>
                <p class="mb-2">TCP ç™¼é€æ–¹ç¶­è­·ä¸€å€‹ã€Œæ“å¡çª—å£ã€(cwnd)ï¼Œå®ƒé™åˆ¶äº†ç™¼é€æ–¹åœ¨ä»»ä½•æ™‚åˆ»å¯ä»¥æ“æœ‰çš„æœªç¢ºèªçš„åœ¨é€”è³‡æ–™é‡ã€‚TCP çš„ç™¼é€é€Ÿç‡ç´„ç­‰æ–¼ `cwnd / RTT`ã€‚</p>
                <p class="mb-2">TCP æ“å¡æ§åˆ¶çš„æ ¸å¿ƒæ¼”ç®—æ³•æ˜¯ã€ŒåŠ æ€§å¢åŠ ï¼Œä¹˜æ€§æ¸›å°‘ã€(AIMD)ï¼š</p>
                <ul class="list-disc list-inside mb-3 space-y-1">
                    <li><strong class="font-semibold">åŠ æ€§å¢åŠ  (Additive Increase):</strong> ç•¶ç¶²è·¯æœªæ“å¡æ™‚ (å³æ²’æœ‰å°åŒ…éºå¤±)ï¼ŒTCP æœƒåœ¨æ¯å€‹ RTT å…§å°‡ `cwnd` å¢åŠ ä¸€å€‹ MSS (Maximum Segment Size)ã€‚é€™æ˜¯ä¸€å€‹ç·©æ…¢çš„æ¢æ¸¬éç¨‹ã€‚</li>
                    <li><strong class="font-semibold">ä¹˜æ€§æ¸›å°‘ (Multiplicative Decrease):</strong> ç•¶æª¢æ¸¬åˆ°å°åŒ…éºå¤± (è¡¨ç¤ºæ“å¡) æ™‚ï¼ŒTCP æœƒå°‡ `cwnd` å¤§å¹…æ¸›å°‘ã€‚é€šå¸¸æ˜¯æ¸›åŠ (å°æ–¼ç”±ä¸‰å€‹é‡è¤‡ ACK æª¢æ¸¬åˆ°çš„éºå¤±) æˆ–é™è‡³ 1 MSS (å°æ–¼è¶…æ™‚æª¢æ¸¬åˆ°çš„éºå¤±)ã€‚</li>
                </ul>
                <div class="chart-container my-4">
                    <canvas id="cwndChart"></canvas>
                </div>
                <p class="text-sm text-center mb-3">ä¸Šåœ–ç¤ºæ„äº† TCP æ“å¡çª—å£ (cwnd) éš¨æ™‚é–“è®ŠåŒ–çš„å…¸å‹ã€Œé‹¸é½’ç‹€ã€è¡Œç‚ºã€‚</p>

                <h3 class="text-xl font-semibold mb-2 text-amber-600">TCP æ“å¡æ§åˆ¶éšæ®µ</h3>
                <ul class="list-disc list-inside mb-3 space-y-1">
                    <li><strong class="font-semibold">æ…¢å•Ÿå‹• (Slow Start):</strong> é€£æ¥é–‹å§‹æ™‚ï¼Œ`cwnd` åˆå§‹è¨­ç‚º 1 MSSã€‚åœ¨æ…¢å•Ÿå‹•éšæ®µï¼Œæ¯æ”¶åˆ°ä¸€å€‹ ACKï¼Œ`cwnd` å°±å¢åŠ  1 MSSï¼Œå°è‡´ `cwnd` å¤§è‡´æ¯éš”ä¸€å€‹ RTT ç¿»å€ï¼Œå‘ˆæŒ‡æ•¸ç´šå¢é•·ã€‚æ…¢å•Ÿå‹•æŒçºŒåˆ° `cwnd` é”åˆ°ã€Œæ…¢å•Ÿå‹•é–¾å€¼ã€(ssthresh) æˆ–æª¢æ¸¬åˆ°å°åŒ…éºå¤±ã€‚</li>
                    <li><strong class="font-semibold">æ“å¡é¿å… (Congestion Avoidance):</strong> ç•¶ `cwnd` è¶…é `ssthresh` å¾Œï¼ŒTCP é€²å…¥æ“å¡é¿å…éšæ®µã€‚æ­¤æ™‚ï¼Œ`cwnd` çš„å¢é•·è®Šç‚ºç·šæ€§ï¼Œå¤§ç´„æ¯å€‹ RTT å¢åŠ  1 MSSã€‚ç›®çš„æ˜¯æ›´è¬¹æ…åœ°æ¢æ¸¬å¯ç”¨é »å¯¬ã€‚</li>
                    <li><strong class="font-semibold">å¿«é€Ÿé‡å‚³èˆ‡å¿«é€Ÿæ¢å¾© (Fast Retransmit and Fast Recovery):</strong> å¦‚æœç™¼é€æ–¹æ”¶åˆ°ä¸‰å€‹é‡è¤‡çš„ ACKï¼Œå®ƒæœƒèªç‚ºä¸€å€‹å°åŒ…å·²ç¶“éºå¤±ï¼Œä¸¦ç«‹å³é‡å‚³è©²éºå¤±çš„å°åŒ… (å¿«é€Ÿé‡å‚³)ï¼Œè€Œç„¡éœ€ç­‰å¾…è¶…æ™‚ã€‚ä¹‹å¾Œï¼ŒTCP é€²å…¥å¿«é€Ÿæ¢å¾©éšæ®µï¼Œå°‡ `ssthresh` è¨­ç‚ºç•¶å‰ `cwnd` çš„ä¸€åŠï¼Œä¸¦å°‡ `cwnd` è¨­ç‚ºæ–°çš„ `ssthresh` åŠ ä¸Š 3 MSS (ä»£è¡¨ä¸‰å€‹é‡è¤‡ ACK è§¸ç™¼çš„å°åŒ…)ï¼Œç„¶å¾Œé€²å…¥æ“å¡é¿å…éšæ®µã€‚é€™æ¯”ç­‰å¾…è¶…æ™‚å¾Œå°‡ `cwnd` é™è‡³ 1 MSS æ›´ç‚ºç©æ¥µã€‚</li>
                </ul>
                 <p class="mt-3">ç•¶ç™¼ç”Ÿè¶…æ™‚äº‹ä»¶æ™‚ï¼Œ`ssthresh` é€šå¸¸è¨­ç‚ºç•¶å‰ `cwnd` çš„ä¸€åŠï¼Œè€Œ `cwnd` è¢«é‡ç½®ç‚º 1 MSSï¼Œç„¶å¾Œé‡æ–°é–‹å§‹æ…¢å•Ÿå‹•éç¨‹ã€‚</p>
            </section>

            <section id="evolution" class="content-section">
                <h2 class="text-2xl font-bold mb-4 text-amber-700">å‚³è¼¸å±¤æ¼”é€²</h2>
                <p class="mb-3">TCP å’Œ UDP ä½œç‚ºä¸»è¦çš„å‚³è¼¸å”å®šå·²ç¶“æœå‹™äº†æ•¸åå¹´ã€‚ç„¶è€Œï¼Œéš¨è‘—ç¶²è·¯ç’°å¢ƒå’Œæ‡‰ç”¨éœ€æ±‚çš„è®ŠåŒ–ï¼Œå‚³è¼¸å±¤çš„åŠŸèƒ½ä¹Ÿåœ¨ä¸æ–·æ¼”é€²ã€‚ä¸€å€‹é¡¯è‘—çš„è¶¨å‹¢æ˜¯å°‡ä¸€äº›å‚³çµ±ä¸Šç”±å‚³è¼¸å±¤æä¾›çš„åŠŸèƒ½è½‰ç§»åˆ°æ‡‰ç”¨å±¤ï¼Œä¸¦åœ¨ UDP ä¹‹ä¸Šæ§‹å»ºæ–°çš„å”å®šã€‚</p>
                <h3 class="text-xl font-semibold mb-2 text-amber-600">QUIC (Quick UDP Internet Connections)</h3>
                <p class="mb-2">QUIC æ˜¯ä¸€å€‹ç”± Google é–‹ç™¼çš„ç¾ä»£å‚³è¼¸å”å®šï¼Œç¾åœ¨å·²æˆç‚º IETF æ¨™æº–ï¼Œä¸¦ä½œç‚º HTTP/3 çš„åº•å±¤å‚³è¼¸æ©Ÿåˆ¶ã€‚QUIC é‹è¡Œåœ¨ UDP ä¹‹ä¸Šï¼Œæ—¨åœ¨è§£æ±º TCP çš„ä¸€äº›å›ºæœ‰å•é¡Œï¼Œä¸¦æä¾›æ›´ä½³çš„æ€§èƒ½å’Œéˆæ´»æ€§ã€‚</p>
                <h4 class="text-lg font-semibold mt-3 mb-1 text-amber-600">QUIC çš„ä¸»è¦ç‰¹æ€§èˆ‡å„ªå‹¢ï¼š</h4>
                <ul class="list-disc list-inside mb-3 space-y-1">
                    <li><strong class="font-semibold">æ¸›å°‘é€£æ¥å»ºç«‹å»¶é²:</strong> QUIC å¯ä»¥åœ¨ 0-RTT æˆ– 1-RTT å…§å®Œæˆé€£æ¥å»ºç«‹å’ŒåŠ å¯†æ¡æ‰‹ï¼Œè€Œå‚³çµ±çš„ TCP + TLS é€šå¸¸éœ€è¦ 2-3 RTTã€‚</li>
                    <li><strong class="font-semibold">æ”¹é€²çš„æ“å¡æ§åˆ¶:</strong> QUIC å…§å»ºäº†æ›´å…ˆé€²å’Œå¯æ’æ‹”çš„æ“å¡æ§åˆ¶æ©Ÿåˆ¶ã€‚</li>
                    <li><strong class="font-semibold">å¤šè·¯å¾‘å‚³è¼¸:</strong> QUIC æ”¯æŒåœ¨å¤šå€‹ç¶²è·¯è·¯å¾‘ä¸ŠåŒæ™‚å‚³è¼¸è³‡æ–™ã€‚</li>
                    <li><strong class="font-semibold">è§£æ±ºéšŠé ­é˜»å¡ (Head-of-Line Blocking):</strong>
                        <ul class="list-circle list-inside ml-4">
                            <li>åœ¨ TCP ä¸­ï¼Œå¦‚æœä¸€å€‹å°åŒ…éºå¤±ï¼Œå¾ŒçºŒåˆ°é”çš„å°åŒ…å³ä½¿å±¬æ–¼ä¸åŒçš„æ‡‰ç”¨å±¤æµï¼Œä¹Ÿå¿…é ˆç­‰å¾…è©²éºå¤±å°åŒ…è¢«é‡å‚³å’Œæ¥æ”¶ï¼Œé€™å°±æ˜¯éšŠé ­é˜»å¡ã€‚</li>
                            <li>QUIC åœ¨å–®å€‹é€£æ¥å…§æ”¯æŒå¤šå€‹ç¨ç«‹çš„ã€Œæµ (streams)ã€ã€‚ä¸€å€‹æµä¸­çš„å°åŒ…éºå¤±ä¸æœƒé˜»å¡å…¶ä»–æµçš„è™•ç†ï¼Œå› ç‚ºæ¯å€‹æµéƒ½æœ‰è‡ªå·±çš„æµé‡æ§åˆ¶å’Œå¯é æ€§æ©Ÿåˆ¶ã€‚</li>
                        </ul>
                    </li>
                    <li><strong class="font-semibold">é€£æ¥é·ç§»:</strong> ç•¶å®¢æˆ¶ç«¯çš„ IP ä½å€æˆ–åŸ è™Ÿæ”¹è®Šæ™‚ (ä¾‹å¦‚å¾ Wi-Fi åˆ‡æ›åˆ°è¡Œå‹•ç¶²è·¯)ï¼ŒQUIC é€£æ¥å¯ä»¥ä¿æŒä¸æ–·é–‹ï¼Œè€Œ TCP é€£æ¥é€šå¸¸æœƒä¸­æ–·ã€‚</li>
                    <li><strong class="font-semibold">å…§å»ºåŠ å¯†:</strong> QUIC çš„æ‰€æœ‰å‚³è¼¸éƒ½é è¨­åŠ å¯† (é¡ä¼¼æ–¼ TLS)ï¼Œæä¾›äº†æ›´å¥½çš„å®‰å…¨æ€§ã€‚</li>
                </ul>
                <p>QUIC çš„è¨­è¨ˆä»£è¡¨äº†å‚³è¼¸å±¤åŠŸèƒ½å‘æ‡‰ç”¨å±¤è½‰ç§»çš„ä¸€ç¨®è¶¨å‹¢ï¼Œåˆ©ç”¨ UDP çš„éˆæ´»æ€§ä¾†æ›´å¿«åœ°éƒ¨ç½²å’Œæ¼”é€²æ–°çš„å‚³è¼¸ç‰¹æ€§ï¼Œè€Œç„¡éœ€ä¿®æ”¹ä½œæ¥­ç³»çµ±æ ¸å¿ƒä¸­çš„ TCP/IP å †ç–Šã€‚</p>
            </section>
        </main>

        <footer class="mt-8 text-center text-sm text-amber-700">
            <p>&copy; 2025 äº’å‹•å¼å‚³è¼¸å±¤å­¸ç¿’æŒ‡å—ã€‚åŸºæ–¼ Kurose & Ross æ•™æå…§å®¹è£½ä½œã€‚</p>
        </footer>
    </div>

    <div id="chatButton" class="chat-button">ğŸ’¬</div>

    <div id="chatWindow" class="chat-window">
        <div class="chat-header">
            <span>å‚³è¼¸å±¤å°åŠ©æ‰‹</span>
            <button id="chatCloseButton" class="chat-close-button">&times;</button>
        </div>
        <div id="chatMessages" class="chat-messages flex flex-col">
            <div class="message-bubble message-bot">æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„å‚³è¼¸å±¤å°åŠ©æ‰‹ï¼Œæœ‰ä»€éº¼å•é¡Œå¯ä»¥å•æˆ‘å–”ï¼</div>
        </div>
        <div class="chat-input-area">
            <textarea id="chatInput" class="chat-input" placeholder="è¼¸å…¥æ‚¨çš„å•é¡Œ..." rows="1"></textarea>
            <button id="chatSendButton" class="chat-send-button">ç™¼é€</button>
        </div>
    </div>

    <script>
        // Get all navigation buttons and content sections
        const navButtons = document.querySelectorAll('.nav-button');
        const contentSections = document.querySelectorAll('.content-section');
        const mainContent = document.getElementById('main-content');

        /**
         * Shows the content section corresponding to the given targetId and updates navigation button styles.
         * @param {string} targetId The ID of the section to show.
         */
        function showSection(targetId) {
            // Hide all content sections
            contentSections.forEach(section => {
                section.classList.remove('active');
            });
            // Deactivate all navigation buttons
            navButtons.forEach(button => {
                button.classList.remove('active');
            });

            // Find the target section and button
            const targetSection = document.getElementById(targetId);
            const targetButton = document.querySelector(`.nav-button[data-target="${targetId}"]`);

            // Activate the target section and scroll to top of main content
            if (targetSection) {
                targetSection.classList.add('active');
                mainContent.scrollTop = 0; // For older browsers
                mainContent.scrollTo({ top: 0, behavior: 'smooth' }); // For modern browsers with smooth scroll
            }
            // Activate the target button
            if (targetButton) {
                targetButton.classList.add('active');
            }
        }

        // Add click event listeners to all navigation buttons
        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetId = button.dataset.target;
                showSection(targetId);
            });
        });

        // Show the first section by default when the page loads
        if (navButtons.length > 0) {
            showSection(navButtons[0].dataset.target);
        }

        // --- Tooltip functionality for UDP segment fields ---
        const udpFields = document.querySelectorAll('#udp .tcp-segment-field');
        const udpTooltip = document.getElementById('udp-field-description-tooltip');
        udpFields.forEach(field => {
            field.addEventListener('mouseenter', (e) => {
                udpTooltip.textContent = field.dataset.description;
                udpTooltip.style.display = 'block';
                // Position tooltip relative to the main content area
                const mainRect = mainContent.getBoundingClientRect();
                udpTooltip.style.left = `${e.clientX - mainRect.left + 15}px`;
                udpTooltip.style.top = `${e.clientY - mainRect.top + 15}px`;
            });
            field.addEventListener('mouseleave', () => {
                udpTooltip.style.display = 'none';
            });
        });
        
        // --- Tooltip functionality for TCP segment fields ---
        const tcpFields = document.querySelectorAll('#tcp .tcp-segment-field');
        const tcpTooltip = document.getElementById('tcp-field-description-tooltip');
        tcpFields.forEach(field => {
            field.addEventListener('mouseenter', (e) => {
                tcpTooltip.textContent = field.dataset.description;
                tcpTooltip.style.display = 'block';
                // Position tooltip relative to the main content area
                const mainRect = mainContent.getBoundingClientRect();
                tcpTooltip.style.left = `${e.clientX - mainRect.left + 15}px`;
                tcpTooltip.style.top = `${e.clientY - mainRect.top + 15}px`;
            });
            field.addEventListener('mouseleave', () => {
                tcpTooltip.style.display = 'none';
            });
        });

        // --- TCP 3-way handshake animation ---
        const handshakeSteps = document.querySelectorAll('#three-way-handshake .handshake-step');
        const animateHandshakeBtn = document.getElementById('animateHandshakeBtn');
        let currentStep = 0;
        let handshakeInterval;

        /**
         * Reveals the next step in the 3-way handshake animation.
         */
        function showNextStep() {
            if (currentStep < handshakeSteps.length) {
                handshakeSteps[currentStep].classList.add('visible');
                currentStep++;
            } else {
                clearInterval(handshakeInterval); // Stop the animation when all steps are shown
            }
        }

        // Add click listener to the handshake animation button
        if(animateHandshakeBtn) {
            animateHandshakeBtn.addEventListener('click', () => {
                currentStep = 0; // Reset step counter
                handshakeSteps.forEach(step => step.classList.remove('visible')); // Hide all steps
                clearInterval(handshakeInterval); // Clear any existing interval to prevent multiple animations
                handshakeInterval = setInterval(showNextStep, 1000); // Start animation, showing a step every 1 second
            });
        }

        // --- CWND Chart (TCP Congestion Control) ---
        const cwndChartCtx = document.getElementById('cwndChart')?.getContext('2d');
        let myCwndChart; // Declare chart variable globally to be accessible

        if (cwndChartCtx) {
            const initialData = {
                labels: [0], // Initial RTT time
                datasets: [{
                    label: 'æ“å¡çª—å£ (cwnd) å¤§å° (MSS)',
                    data: [1], // Initial cwnd size
                    borderColor: '#d97706', // amber-600
                    backgroundColor: '#fef3c7', // amber-100
                    fill: false,
                    tension: 0.1 // Smooth line
                }]
            };

            const cwndChartConfig = {
                type: 'line',
                data: initialData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // Allow chart to resize freely
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'æ™‚é–“ (RTT é€±æœŸ)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'cwnd (MSS)'
                            },
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    return 'RTT ' + tooltipItems[0].label;
                                }
                            }
                        },
                        legend: {
                            labels: {
                                font: {
                                    size: 12
                                }
                            }
                        }
                    }
                }
            };
            myCwndChart = new Chart(cwndChartCtx, cwndChartConfig); // Initialize the chart

            // Simulation variables for cwnd growth
            let time = 0;
            let cwnd = 1;
            let ssthresh = 16; // Example initial ssthresh (slow start threshold)
            let phase = 'slow-start'; // Current congestion control phase

            /**
             * Simulates the TCP congestion window behavior (AIMD and Slow Start).
             * Updates the chart data and re-renders it.
             */
            function updateCwndChart() {
                time++; // Increment time (representing RTT cycles)

                // Apply Slow Start or Congestion Avoidance logic
                if (phase === 'slow-start') {
                    cwnd *= 2; // Exponential growth
                    if (cwnd >= ssthresh) {
                        phase = 'congestion-avoidance'; // Transition to congestion avoidance
                    }
                } else if (phase === 'congestion-avoidance') {
                    cwnd += 1; // Linear growth
                }

                // Simulate a loss event every 10 RTTs for demonstration
                if (time % 10 === 0 && time > 0) {
                    ssthresh = Math.max(Math.floor(cwnd / 2), 2); // Halve ssthresh
                    cwnd = 1; // Reset cwnd to 1 (TCP Tahoe-like behavior for simplicity)
                    phase = 'slow-start'; // Re-enter slow start
                    myCwndChart.data.datasets[0].borderColor = '#ef4444'; // Change line color to red for loss
                } else {
                    myCwndChart.data.datasets[0].borderColor = '#d97706'; // Normal amber color
                }

                // Stop simulation after 25 RTTs to keep the chart from growing indefinitely
                if (time <= 25) {
                    myCwndChart.data.labels.push(time); // Add new time label
                    myCwndChart.data.datasets[0].data.push(cwnd); // Add new cwnd value
                    myCwndChart.update(); // Update the chart
                    setTimeout(updateCwndChart, 1500); // Schedule next update after 1.5 seconds
                }
            }

            // Use a MutationObserver to start the chart animation only when its section becomes active.
            // This prevents the animation from running in the background.
            const observer = new MutationObserver((mutationsList, obs) => {
                for(const mutation of mutationsList) {
                    // Check if the 'class' attribute changed on the tcp-congestion section
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        const tcpCongestionSection = document.getElementById('tcp-congestion');
                        // If the section is active and the chart hasn't been animated yet (or reset)
                        if (tcpCongestionSection && tcpCongestionSection.classList.contains('active')) {
                            // Only start if the chart data is in its initial state (labels.length <= 1)
                            // This ensures the animation doesn't restart if the user navigates away and comes back
                            if (myCwndChart.data.labels.length <= 1) { 
                                // Reset chart data for a fresh animation if needed
                                myCwndChart.data.labels = [0];
                                myCwndChart.data.datasets[0].data = [1];
                                time = 0;
                                cwnd = 1;
                                ssthresh = 16;
                                phase = 'slow-start';
                                setTimeout(updateCwndChart, 1500);
                            }
                            // obs.disconnect(); // Uncomment if you only want the chart to animate ONCE per page load
                            return;
                        }
                    }
                }
            });
            const tcpCongestionSection = document.getElementById('tcp-congestion');
            if(tcpCongestionSection) {
                 observer.observe(tcpCongestionSection, { attributes: true });
            }
        }

        // --- Chatbot functionality ---
        const chatButton = document.getElementById('chatButton');
        const chatWindow = document.getElementById('chatWindow');
        const chatCloseButton = document.getElementById('chatCloseButton');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const chatSendButton = document.getElementById('chatSendButton');

        // Initialize chat history with a bot greeting
        let chatHistory = [{ role: "model", parts: [{ text: "æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„å‚³è¼¸å±¤å°åŠ©æ‰‹ï¼Œæœ‰ä»€éº¼å•é¡Œå¯ä»¥å•æˆ‘å–”ï¼" }] }];

        // Toggle chat window visibility
        chatButton.addEventListener('click', () => {
            chatWindow.classList.toggle('open');
            if (chatWindow.classList.contains('open')) {
                chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom when opening
                chatInput.focus(); // Focus input field
            }
        });

        // Close chat window
        chatCloseButton.addEventListener('click', () => {
            chatWindow.classList.remove('open');
        });

        // Send message on Enter key press (unless Shift is held for new line)
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault(); // Prevent new line
                sendMessage();
            }
        });

        // Send message on button click
        chatSendButton.addEventListener('click', sendMessage);

        /**
         * Sends the user's message to the Gemini API and displays the response.
         */
        async function sendMessage() {
            const userMessage = chatInput.value.trim();
            if (userMessage === '') return; // Don't send empty messages

            // Display user message in chat
            appendMessage(userMessage, 'user');
            chatInput.value = ''; // Clear input field
            chatInput.style.height = '40px'; // Reset textarea height

            // Add user message to chat history for API call
            chatHistory.push({ role: "user", parts: [{ text: userMessage }] });

            // Show loading indicator
            const loadingBubble = appendMessage('æ€è€ƒä¸­...', 'bot loading');
            chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom

            // Disable input and send button during API call
            chatInput.disabled = true;
            chatSendButton.disabled = true;

            try {
                const payload = { contents: chatHistory };
                // The API key is provided by the Canvas environment at runtime
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                // Remove loading indicator
                chatMessages.removeChild(loadingBubble);

                // Process and display bot's response
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const botResponse = result.candidates[0].content.parts[0].text;
                    appendMessage(botResponse, 'bot');
                    chatHistory.push({ role: "model", parts: [{ text: botResponse }] }); // Add bot's response to history
                } else {
                    appendMessage('æŠ±æ­‰ï¼Œæˆ‘ç„¡æ³•ç†è§£æ‚¨çš„å•é¡Œã€‚', 'bot');
                }
            } catch (error) {
                console.error('Gemini API error:', error);
                // Remove loading indicator
                chatMessages.removeChild(loadingBubble);
                appendMessage('ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚', 'bot');
            } finally {
                // Re-enable input and send button
                chatInput.disabled = false;
                chatSendButton.disabled = false;
                chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom after response
                chatInput.focus(); // Focus input field
            }
        }

        /**
         * Appends a new message bubble to the chat window.
         * @param {string} text The text content of the message.
         * @param {string} sender The sender type ('user', 'bot', 'bot loading').
         * @returns {HTMLElement} The created message bubble element.
         */
        function appendMessage(text, sender) {
            const bubble = document.createElement('div');
            bubble.classList.add('message-bubble');
            if (sender === 'user') {
                bubble.classList.add('message-user');
            } else if (sender === 'bot') {
                bubble.classList.add('message-bot');
            } else if (sender === 'bot loading') {
                bubble.classList.add('message-bot', 'message-loading');
            }
            bubble.textContent = text;
            chatMessages.appendChild(bubble);
            chatMessages.scrollTop = chatMessages.scrollHeight; // Auto-scroll to bottom
            return bubble; // Return the bubble element for potential removal (e.g., loading indicator)
        }

        // Adjust textarea height dynamically based on content
        chatInput.addEventListener('input', () => {
            chatInput.style.height = 'auto'; // Reset height to recalculate
            chatInput.style.height = chatInput.scrollHeight + 'px'; // Set height to fit content
        });
    </script>
</body>
</html>
